# sudo ln -sf /home/ec2-user/CEG-7370-Project/aws/phi-store-le-ssl.conf /etc/httpd/conf.d/phi-store-le-ssl.conf
# sudo apachectl configtest
# sudo systemctl restart httpd

# http -> https
<VirtualHost *:80>
    ServerName phi-store.net
    ServerAlias 52.6.125.198
    Redirect / https://phi-store.net/
</VirtualHost>

<IfModule mod_ssl.c>

<VirtualHost *:443>
    ServerName phi-store.net
    ServerAlias 52.6.125.198

    # frontend build
    DocumentRoot /home/ec2-user/CEG-7370-Project/phi-frontend/build
    <Directory /home/ec2-user/CEG-7370-Project/phi-frontend/build>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # proxy requests to backend
    ProxyPreserveHost On
    ProxyPass /api http://localhost:3001/api
    ProxyPassReverse /api http://localhost:3001/api

    ErrorLog /var/log/httpd/phi_error.log
    CustomLog /var/log/httpd/phi_access.log combined

    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/phi-store.net/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/phi-store.net/privkey.pem

    # allow long-running backend requests like phi-store i think will probably take
    ProxyTimeout 600

</VirtualHost>

</IfModule>
