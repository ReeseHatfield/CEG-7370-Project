#
# sudo ln -sf /home/ec2-user/CEG-7370-Project/aws/phi-store.conf /etc/httpd/conf.d/phi-store.conf
# sudo systemctl restart httpd
<VirtualHost *:80>
    ServerName 52.6.125.198

    # --- Proxy setup ---
    ProxyPreserveHost On

    # Frontend 
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # Backend API
    ProxyPass /api http://localhost:3001/
    ProxyPassReverse /api http://localhost:3001/

    ProxyPass /api/ http://localhost:3001/api/
    ProxyPassReverse /api/ http://localhost:3001/api/


    # --- CORS headers for localhost frontend ---
    <IfModule mod_headers.c>
        Header always set Access-Control-Allow-Origin "http://localhost:3000"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
        Header always set Access-Control-Allow-Credentials "true"
    </IfModule>

    # --- Handle OPTIONS preflight requests ---
    <Location "/api">
        <Limit OPTIONS>
            Require all granted
            Header always set Access-Control-Allow-Origin "http://localhost:3000"
            Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
            Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
            Header always set Access-Control-Allow-Credentials "true"
            Header always set Access-Control-Max-Age "86400"
        </Limit>
    </Location>

    # --- Logging ---
    ErrorLog /var/log/httpd/phi_error.log
    CustomLog /var/log/httpd/phi_access.log combined
</VirtualHost>
